set enable_seqscan to off;
set enable_seqscan to on;

CREATE EXTENSION  pg_trgm;

SELECT * FROM accounts WHERE screen_name LIKE '%ldonaldt%';


SELECT * FROM accounts WHERE screen_name = 'realDonaldTrump';


-- ver1 many seconds
SELECT tweets.content, null as col2 FROM tweets 
WHERE to_tsvector('english', tweets.content) @@ to_tsquery('John | Oliver')
UNION ALL
SELECT accounts.name, accounts.description FROM accounts 
WHERE to_tsvector('english', accounts.name || ' ' || accounts.description) @@ to_tsquery('John | Oliver')
ORDER BY tweets.retweet_count


-- ver2 652ms
SELECT * FROM tweets 
JOIN accounts ON tweets.author_id=accounts.id
WHERE to_tsvector('english', accounts.name || ' ' || accounts.description) @@ to_tsquery('John | Oliver')
AND to_tsvector('english', tweets.content) @@ to_tsquery('John | Oliver')
ORDER BY tweets.retweet_count DESC


-- ver3
SELECT t1.id, t1.content, t1.retweet_count as retweet_count, t1.author_id, 
a1.id, a1.name, a1.description
FROM tweets t1
JOIN accounts a1 ON t1.author_id=a1.id
WHERE to_tsvector('english', t1.content) @@ to_tsquery('John | Oliver')
UNION
SELECT t2.id, t2.content, t2.retweet_count as retweet_count, t2.author_id,
a2.id, a2.name, a2.description FROM tweets t2
JOIN accounts a2 ON t2.author_id=a2.id 
WHERE to_tsvector('english', a2.name || ' ' || a2.description) @@ to_tsquery('John | Oliver')
ORDER BY retweet_count DESC



SELECT * FROM tweets 
WHERE tweets.author_id = 



SELECT * FROM pg_stat_activity WHERE state = 'active';


SELECT pg_terminate_backend(19476);



